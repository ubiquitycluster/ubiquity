
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ubiquitycluster.github.io/ubiquity/admin-guide/deployment/cloud/terraform_cloud/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../../../administration/tutorials/add-or-remove-nodes/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Terraform Cloud - Ubiquity</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#terraform-cloud" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Ubiquity" class="md-header__button md-logo" aria-label="Ubiquity" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ubiquity
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Terraform Cloud
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ubiquitycluster/ubiquity" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ubiquitycluster/ubiquity
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Ubiquity" class="md-nav__button md-logo" aria-label="Ubiquity" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Ubiquity
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ubiquitycluster/ubiquity" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ubiquitycluster/ubiquity
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Admin Guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Admin Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sandbox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sandbox
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../on-prem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    On-Premises
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../external-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    External Resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../post-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Post Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2_7" >
        
          
          <label class="md-nav__link" for="__nav_3_2_7" id="__nav_3_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Production
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_7">
            <span class="md-nav__icon md-icon"></span>
            Production
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../production/prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../production/external-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    External Resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../production/configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../production/deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../production/post-installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Post Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../production/airgapping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Air Gapping
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../production/awx-postinstall/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWX Post Install
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../production/hfi-infiniband/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    InfiniBand
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_8" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Cloud
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2_8" id="__nav_3_2_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_8">
            <span class="md-nav__icon md-icon"></span>
            Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Terraform Cloud
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Terraform Cloud
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      What is Terraform Cloud?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started-with-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Getting started with Terraform Cloud
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-a-ubiquity-cluster-with-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Managing a Ubiquity cluster with Terraform Cloud
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Managing a Ubiquity cluster with Terraform Cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-workspace" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the workspace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#providing-cloud-provider-credentials-to-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Providing cloud provider credentials to Terraform Cloud
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Providing cloud provider credentials to Terraform Cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws" class="md-nav__link">
    <span class="md-ellipsis">
      AWS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure" class="md-nav__link">
    <span class="md-ellipsis">
      Azure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#google-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Google Cloud
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openstack-ovh" class="md-nav__link">
    <span class="md-ellipsis">
      OpenStack / OVH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#providing-dns-provider-credentials-to-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Providing DNS provider credentials to Terraform Cloud
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Providing DNS provider credentials to Terraform Cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudflare" class="md-nav__link">
    <span class="md-ellipsis">
      CloudFlare
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#google-cloud-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Google Cloud DNS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#managing-ubiquity-variables-with-terraform-cloud-ui" class="md-nav__link">
    <span class="md-ellipsis">
      Managing Ubiquity variables with Terraform Cloud UI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applying-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Applying changes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applying changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#auto-apply" class="md-nav__link">
    <span class="md-ellipsis">
      Auto apply
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ubiquity-terraform-cloud-and-the-cli" class="md-nav__link">
    <span class="md-ellipsis">
      Ubiquity, Terraform Cloud and the CLI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-ubiquity-autoscaling" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Ubiquity Autoscaling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enable Ubiquity Autoscaling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#troubleshoot-autoscaling-with-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshoot autoscaling with Terraform Cloud
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Administration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Administration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_1" id="__nav_3_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_1">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/add-or-remove-nodes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Add/Remove Nodes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/backup-cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Backup Cluster
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/expose-services-to-the-internet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Expose Services
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/manual-dns-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manual DNS Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/run-commands-on-multiple-nodes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi-Node Commands
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/single-node-cluster-adjustments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Single Node Adjustments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/user-accounts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Accounts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/use-both-github-and-gitea/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitHub and Gitea
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/updating-documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Update Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/kube-prometheus-stack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring Stack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/loki-promtail/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging Stack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/ssl-cert-change-git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SSL Certificates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/install-pre-commit-hooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pre-commit Hooks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../administration/tutorials/shutdown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shutdown Procedures
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/certificate-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Certificate Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/opus-container/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Opus Container
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/pxe-boot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PXE Boot
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Runbooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Runbooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/argocd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ArgoCD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/cert-manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cert Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/dnsmasq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DNSmasq
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/gitea/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gitea
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/longhorn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Longhorn
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/vault/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vault
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/onyxia/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Onyxia
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/osimages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OS Images
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/ofed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OFED
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/matrix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Matrix
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/etcd-alerts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    etcd Alerts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../runbooks/awx/backup/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    AWX
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5_13" id="__nav_3_5_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_13">
            <span class="md-nav__icon md-icon"></span>
            AWX
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/awx/restore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Restore
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/awx/git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/awx/runner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../runbooks/awx/tips/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tips
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Troubleshooting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/bmh-provisioning-error/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BMH Provisioning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../user-guide/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/onboarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Onboarding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../user-guide/EasyBuild/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EasyBuild
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/screenshots/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Screenshots
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      What is Terraform Cloud?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started-with-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Getting started with Terraform Cloud
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#managing-a-ubiquity-cluster-with-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Managing a Ubiquity cluster with Terraform Cloud
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Managing a Ubiquity cluster with Terraform Cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-the-workspace" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the workspace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#providing-cloud-provider-credentials-to-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Providing cloud provider credentials to Terraform Cloud
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Providing cloud provider credentials to Terraform Cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aws" class="md-nav__link">
    <span class="md-ellipsis">
      AWS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure" class="md-nav__link">
    <span class="md-ellipsis">
      Azure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#google-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Google Cloud
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#openstack-ovh" class="md-nav__link">
    <span class="md-ellipsis">
      OpenStack / OVH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#providing-dns-provider-credentials-to-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Providing DNS provider credentials to Terraform Cloud
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Providing DNS provider credentials to Terraform Cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudflare" class="md-nav__link">
    <span class="md-ellipsis">
      CloudFlare
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#google-cloud-dns" class="md-nav__link">
    <span class="md-ellipsis">
      Google Cloud DNS
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#managing-ubiquity-variables-with-terraform-cloud-ui" class="md-nav__link">
    <span class="md-ellipsis">
      Managing Ubiquity variables with Terraform Cloud UI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applying-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Applying changes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applying changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#auto-apply" class="md-nav__link">
    <span class="md-ellipsis">
      Auto apply
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ubiquity-terraform-cloud-and-the-cli" class="md-nav__link">
    <span class="md-ellipsis">
      Ubiquity, Terraform Cloud and the CLI
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable-ubiquity-autoscaling" class="md-nav__link">
    <span class="md-ellipsis">
      Enable Ubiquity Autoscaling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enable Ubiquity Autoscaling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#troubleshoot-autoscaling-with-terraform-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshoot autoscaling with Terraform Cloud
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="terraform-cloud">Terraform Cloud</h1>
<p>This document explains how to use Ubiquity with Terraform Cloud.</p>
<h2 id="what-is-terraform-cloud">What is Terraform Cloud?</h2>
<p>Terraform Cloud is HashiCorpâ€™s managed service that allows to provision
infrastructure using a web browser or a REST API instead of the command-line.
This also means that the provisioned infrastructure parameters can be modified
by a team and the state is stored in the cloud instead of a local machine.</p>
<p>When provisioning in commercial cloud, Terraform Cloud can also
provide a cost estimate of the resources.</p>
<h2 id="getting-started-with-terraform-cloud">Getting started with Terraform Cloud</h2>
<ol>
<li>Create a <a href="https://app.terraform.io/signup/account">Terraform Cloud account</a></li>
<li><a href="https://app.terraform.io/app/organizations/new">Create an organization</a>, join one or choose one available to you</li>
</ol>
<h2 id="managing-a-ubiquity-cluster-with-terraform-cloud">Managing a Ubiquity cluster with Terraform Cloud</h2>
<h3 id="creating-the-workspace">Creating the workspace</h3>
<ol>
<li>Create a git repository in <a href="https://www.github.com/">GitHub</a>, <a href="https://www.gitlab.com/">GitLab</a>,
or any of the <a href="https://www.terraform.io/cloud-docs/vcs">version control system provider supported by Terraform Cloud</a></li>
<li>In this git repository, add a copy of the Ubiquity example <code>main.tf</code>
available for the cloud of your choice</li>
<li>Log in <a href="https://app.terraform.io/signup/account">Terraform Cloud account</a></li>
<li>Create a new workspace<ol>
<li>Choose Type: "Version control workflow"</li>
<li>Connect to VCS: choose the version control provider that hosts your repository</li>
<li>Choose the repository that contains your <code>main.tf</code></li>
<li>Configure settings: tweak the name and description to your liking</li>
<li>Click on "Create workspace"</li>
</ol>
</li>
</ol>
<p>You will be redirected automatically to your new workspace.</p>
<h3 id="providing-cloud-provider-credentials-to-terraform-cloud">Providing cloud provider credentials to Terraform Cloud</h3>
<p>Terraform Cloud will invoke Terraform command-line in a remote virtual environment.
For the CLI to be able to communicate with your cloud provider API, we need to define
environment variables that Terraform will use to authenticate. The next sections
explain which environment variables to define for each cloud provider and how to retrieve
the values of the variable from the provider.</p>
<p>If you plan on using these environment variables with multiple workspaces, it is recommended
to <a href="https://learn.hashicorp.com/tutorials/terraform/cloud-multiple-variable-sets?in=terraform/cloud#create-a-credentials-variable-set">create a credential variable set</a> in Terraform Cloud.</p>
<h4 id="aws">AWS</h4>
<p>You need to define these environment variables:
- <code>AWS_ACCESS_KEY_ID</code>
- <code>AWS_SECRET_ACCESS_KEY</code> (sensitive)</p>
<p>The value of these variables can either correspond to the value of access key created
on the <a href="https://console.aws.amazon.com/iam/home?region=ca-central-1#/security_credentials">AWS Security Credentials - Access keys</a> page, or you can add user dedicated to
Terraform Cloud in <a href="https://console.aws.amazon.com/iam/home?region=ca-central-1#/users">AWS IAM Users</a>,
and use its access key.</p>
<h4 id="azure">Azure</h4>
<p>You need to define these environment variables:
- <code>ARM_CLIENT_ID</code>
- <code>ARM_CLIENT_SECRET</code> (sensitive)
- <code>ARM_SUBSCRIPTION_ID</code>
- <code>ARM_TENANT_ID</code></p>
<p>Refer to <a href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/guides/service_principal_client_secret#creating-a-service-principal">Terraform Azure Provider - Creating a Service Principal</a> to
know how to create a Service Principal and retrieve the values for these environment variables.</p>
<h4 id="google-cloud">Google Cloud</h4>
<p>You need to define this environment variable:
- <code>GOOGLE_CLOUD_KEYFILE_JSON</code> (sensitive)</p>
<p>The value of the variable will be the content of a <a href="https://cloud.google.com/iam/docs/creating-managing-service-accounts">Google Cloud service account</a>
JSON key file expressed a single line string. Example:
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;service_account&quot;</span><span class="p">,</span><span class="nt">&quot;project_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;project-id-1234&quot;</span><span class="p">,</span><span class="nt">&quot;private_key_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abcd1234&quot;</span><span class="p">,</span><span class="err">...</span><span class="p">}</span>
</code></pre></div></p>
<p>You can use <a href="https://stedolan.github.io/jq/"><code>jq</code></a> to format the string from the JSON
file provided by Google:
<div class="highlight"><pre><span></span><code>jq<span class="w"> </span>.<span class="w"> </span>-c<span class="w"> </span>project-name-123456-abcdefjg.json
</code></pre></div></p>
<h4 id="openstack-ovh">OpenStack / OVH</h4>
<p>You need to define these environment variables:
- <code>OS_AUTH_URL</code>
- <code>OS_PROJECT_ID</code>
- <code>OS_REGION_NAME</code>
- <code>OS_INTERFACE</code>
- <code>OS_IDENTITY_API_VERSION</code>
- <code>OS_USER_DOMAIN_NAME</code>
- <code>OS_USERNAME</code>
- <code>OS_PASSWORD</code> (sensitive)</p>
<p>Apart from <code>OS_PASSWORD</code>, the values for these variables are available in
OpenStack RC file provided for your project.</p>
<p>If you prefer to use <a href="https://docs.openstack.org/keystone/queens/user/application_credentials.html">OpenStack application credentials</a>,
you need to define at least these variables:
- <code>OS_AUTH_TYPE</code> 
- <code>OS_AUTH_URL</code>
- <code>OS_APPLICATION_CREDENTIAL_ID</code>
- <code>OS_APPLICATION_CREDENTIAL_SECRET</code></p>
<p>and potentially these too:
- <code>OS_IDENTITY_API_VERSION</code> 
- <code>OS_REGION_NAME</code>
- <code>OS_INTERFACE</code></p>
<p>The values for these variables are available in OpenStack RC file provided
when creating the application credentials.</p>
<h3 id="providing-dns-provider-credentials-to-terraform-cloud">Providing DNS provider credentials to Terraform Cloud</h3>
<p>Terraform Cloud will invoke Terraform command-line in a remote virtual environment.
For the CLI to be able to communicate with your DNS provider API, we need to define
environment variables that Terraform will use to authenticate. The next sections
explain which environment variables to define for each DNS provider and how to retrieve
the values of the variable from the provider.</p>
<h4 id="cloudflare">CloudFlare</h4>
<p>You need to define these environment variables:
- <code>CLOUDFLARE_EMAIL</code>
- <code>CLOUDFLARE_API_KEY</code> (sensitive)</p>
<p>If you prefer using an API token instead of the global API key, you
need to define these environment variables instead:
- <code>CLOUDFLARE_API_TOKEN</code> (sensitive)
- <code>CLOUDFLARE_ZONE_API_TOKEN</code> (sensitive)
- <code>CLOUDFLARE_ZONE_DNS_TOKEN</code> (sensitive)</p>
<h4 id="google-cloud-dns">Google Cloud DNS</h4>
<p>Refer to <a href="#google-cloud">Google Cloud</a> section under
Providing cloud provider credentials to Terraform Cloud. Make sure the
Google Cloud service account can modify your DNS zone.</p>
<h3 id="managing-ubiquity-variables-with-terraform-cloud-ui">Managing Ubiquity variables with Terraform Cloud UI</h3>
<p>It is possible to use Terraform Cloud web interface to define variable
values in your <code>main.tf</code>. For example, you could want to define a guest
password without writing it directly in <code>main.tf</code> to avoid displaying
publicly.</p>
<p>To manage a variable with Terraform Cloud:
1. edit your <code>main.tf</code>
to define the variables you want to manage. In the following example,
we want to manage the number of nodes and the guest password.</p>
<pre><code>Add the variables at the beginning of the `main.tf`:
  ```hcl
  variable "nb_nodes" {}
  variable "password" {}
  ```

Then replace the static value by the variable in our `main.tf`,

compute node count
  ```hcl
  node = { type = "p2-3gb", tags = ["node"], count = var.nb_nodes }
  ```
guest password
  ```hcl
  guest_passwd = var.password
  ```
</code></pre>
<ol>
<li>Commit and push this changes to your git repository.</li>
<li>In Terraform Cloud workspace associated with that repository, go in "Variables.</li>
<li>Under "Terraform Variables", click the "Add variable" button and create a variable for each one defined previously in the <code>main.tf</code>. Check "Sensitive" if the variable content should not never be shown in the UI or the API.</li>
</ol>
<p>You may edit the variables at any point of your cluster lifetime.</p>
<h3 id="applying-changes">Applying changes</h3>
<p>To create your cluster, apply changes made to your <code>main.tf</code> or the variables,
you will need to queue a plan. When you push to the default branch of the linked
git repository, a plan will be automatically created. You can also create a
plan manually. To do so, click on the "Queue plan manually"
button inside your workspace, then "Queue plan".</p>
<p>Once the plan has been successfully created, you can apply it using the "Runs"
section. Click on the latest queued plan, then on the "Apply plan" button at
the bottom of the plan page.</p>
<h4 id="auto-apply">Auto apply</h4>
<p>It is possible to apply automatically a successful plan. Go in the "Settings"
section, and under "Apply method" select "Auto apply". Any following successful
plan will then be automatically applied.</p>
<h2 id="ubiquity-terraform-cloud-and-the-cli">Ubiquity, Terraform Cloud and the CLI</h2>
<p>Terraform cloud only allows to apply or destroy the plan as stated in the main.tf,
but sometimes it can be useful to run some other terraform commands that are only
available through the command-line interface, for example <code>terraform taint</code>.</p>
<p>It is possible to import the terraform state of a cluster on your local computer
and then use the CLI on it.</p>
<ol>
<li>
<p>Log in Terraform cloud:
<div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>login
</code></pre></div></p>
</li>
<li>
<p>Create a folder where the terraform state will be stored:
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>my-cluster-1
</code></pre></div></p>
</li>
<li>
<p>Create a file named <code>cloud.tf</code> with the following content in your cluster folder:
<div class="highlight"><pre><span></span><code><span class="nb">terraform</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb">cloud</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="na">organization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;REPLACE-BY-YOUR-TF-CLOUD-ORG&quot;</span>
<span class="w">    </span><span class="nb">workspaces</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;REPLACE-BY-THE-NAME-OF-YOUR-WORKSPACE&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
replace the values of <code>organization</code> and <code>name</code> with the appropriate value
for your cluster.</p>
</li>
<li>
<p>Initialize the folder and retrieve the state:
<div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>init
</code></pre></div></p>
</li>
</ol>
<p>To confirm the workspace has been properly imported locally, you can list
the resources using:
<div class="highlight"><pre><span></span><code>terraform<span class="w"> </span>state<span class="w"> </span>list
</code></pre></div></p>
<h2 id="enable-ubiquity-autoscaling">Enable Ubiquity Autoscaling</h2>
<p>Ubiquity in combination with Terraform Cloud (TFE) can be configured to give
Slurm the ability to create and destroy instances based on the
job queue content.</p>
<p>To enable this feature:
1. <a href="https://app.terraform.io/app/settings/tokens">Create a TFE API Token</a> and save it somewhere safe.</p>
<pre><code>1.1. If you subscribe to Terraform Cloud Team &amp; Governance plan, you can generate
a [Team API Token](https://www.terraform.io/cloud-docs/users-teams-organizations/api-tokens#team-api-tokens).
The team associated with this token requires no access to organization and can be secret.
It does not have to include any member. Team API token is preferable as its permissions can be
restricted to the minimum required for autoscale purpose.
</code></pre>
<ol>
<li>
<p><a href="#creating-the-workspace">Create a workspace in TFE</a></p>
<p>2.1. Make sure the repo is private as it will contain the API token.</p>
<p>2.2. If you generated a Team API Token in 1, provide access to the workspace to the team:</p>
<ol>
<li>Workspace Settings -&gt; Team Access -&gt; Add team and permissions</li>
<li>Select the team</li>
<li>Click on "Customize permissions for this team"</li>
<li>Under "Runs" select "Apply"</li>
<li>Under "Variables" select "Read and write"</li>
<li>Leave the rest as is and click on "Assign custom permissions"</li>
</ol>
<p>2.3 In <em>Configure settings</em>, under <em>Advanced options</em>, for <em>Apply method</em>, select <em>Auto apply</em>.</p>
</li>
<li>
<p><a href="#providing-cloud-provider-credentials-to-terraform-cloud">Create the environment variables of the cloud provider credentials in TFE</a></p>
</li>
<li><a href="#managing-magic-castle-variables-with-terraform-cloud-ui">Create a variable named <code>pool</code> in TFE</a>. Set value to <code>[]</code> and check <strong>HCL</strong>.</li>
<li>Add a file named <code>data.yaml</code> in your git repo with the following content:
    <div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">profile::slurm::controller::tfe_token</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;TFE API token&gt;</span>
<span class="nt">profile::slurm::controller::tfe_workspace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;TFE workspace id&gt;</span>
</code></pre></div>
    Complete the file by replacing <code>&lt;TFE API TOKEN&gt;</code> with the token generated at step 1
    and <code>&lt;TFE workspace id&gt;</code> (i.e.: <code>ws-...</code>) by the id of the workspace created at step 2.
    It is recommended to encrypt the TFE API token before committing <code>data.yaml</code> in git. Refer
    to section <a href="./README.md#4131-encrypting-hieradata-secrets">4.13.1 of README.md</a> to
    know how to encrypt the token.</li>
<li>Add <code>data.yaml</code> in git and push.</li>
<li>
<p>Modify <code>main.tf</code>:</p>
<ol>
<li>If not already present, add the following definition of the pool variable at the beginning of your <code>main.tf</code>.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;pool&quot;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="na">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Slurm pool of compute nodes&quot;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<ol>
<li>Add instances to <code>instances</code> with the tags <code>pool</code> and <code>node</code>. These are
  the nodes that Slurm will able to create and destroy.</li>
<li>If not already present, add the following line after the instances definition to pass the list of compute nodes from Terraform cloud workspace variable to the provider module:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="na">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">var.pool</span>
</code></pre></div>
<ol>
<li>On the right-hand-side of <code>public_keys =</code>, replace <code>[file("~/.ssh/id_rsa.pub")]</code>
  by a list of SSH public keys that will have admin access to the cluster.</li>
<li>After the line <code>public_keys = ...</code>, add <code>hieradata = file("data.yaml")</code>.</li>
<li>After the line <code>hieradata = ...</code>, add <code>generate_ssh_key = true</code>. This will provide
  Terraform Cloud SSH admin access to the cluster and it will be used to upload configuration
  files.</li>
<li>Stage changes, commit and push to git repo.</li>
</ol>
</li>
<li>
<p>Go to your workspace in TFE, click on Actions -&gt; Start a new run -&gt; Plan and apply -&gt; Start run.
Then, click on "Confirm &amp; Apply" and "Confirm Plan".</p>
</li>
<li>Compute nodes defined in step 8 can be modified at any point in the cluster lifetime and
more <em>pool</em> compute nodes can be added or removed if needed.</li>
</ol>
<p>To reduce the time required for compute nodes to become available in Slurm, consider
<a href="./README.md#1012-create-a-compute-node-image">creating a compute node image</a>.</p>
<h3 id="troubleshoot-autoscaling-with-terraform-cloud">Troubleshoot autoscaling with Terraform Cloud</h3>
<p>If after enabling autoscaling with Terraform Cloud for your Ubiquity cluster,
the number of nodes does not increase when submitting jobs, verify the following
points:</p>
<ol>
<li>Go to the Terraform Cloud workspace webpage, and look for errors in the runs.
If the runs were only triggered by changes to the git repo, it means scaling signals
from the cluster do not reach the Terraform cloud workspace or no signals were sent at all.</li>
<li>Make sure the Terraform Cloud workspace id matches with the value of
<code>profile::slurm::controller::tfe_workspace</code> in <code>data.yaml</code>.</li>
<li>Execute <code>squeue</code> on the cluster, and verify the reasons why jobs are still in the queue.
If under the column <code>(Reason)</code>, there is the keyword <code>ReqNodeNotAvail</code>, it implies
Slurm tried to boot the listed nodes, but they would not show up before the timeout,
therefore Slurm marked them as down. It can happen if your cloud provider is slow to build
the instances, or following a configuration problem like in 2. When Slurm marks a node as
down, a trace is left in slurmctld's log - using zgrep on the slurm controller node (typically <code>mgmt1</code>):
    <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>zgrep<span class="w"> </span><span class="s2">&quot;marking down&quot;</span><span class="w"> </span>/var/log/slurm/slurmctld.log*
</code></pre></div>
    To tell Slurm these nodes are available again, enter the following command:
    <div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>/opt/software/slurm/bin/scontrol<span class="w"> </span>update<span class="w"> </span><span class="nv">nodename</span><span class="o">=</span>node<span class="o">[</span>Y-Z<span class="o">]</span><span class="w"> </span><span class="nv">state</span><span class="o">=</span>IDLE
</code></pre></div>
    Replace <code>node[Y-Z]</code> by the hostname range listed next to <code>ReqNodeNotAvail</code> in <code>squeue</code>.</li>
<li>Under <code>mgmt1:/var/log/slurm</code>, look for errors in the file <code>slurm_resume.log</code>.</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; The Ubiquity Authors
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.indexes", "navigation.expand", "search.highlight", "search.share", "navigation.top", "navigation.tracking", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>